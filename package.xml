<?xml version="1.0" encoding="utf-8"?>
<package
  name="ROFSim"
  displayName="ROF SyncroSim Package"
  version="0.3.0">
  
  <!-- Transformers -->
  <transformers>
    <transformer name="Primary" isPrimary="True">
      <runtime>
        <transformer name="LoadSpadesOutputs"/>
        <transformer name="PrepareHabitatModel"/>
        <transformer name="RunCaribouRSF"/>
      </runtime>
      <include>
        <transformer name="corestime_Runtime"/>
        <transformer name="LoadSpadesOutputs"/>
        <transformer name="PrepareHabitatModel"/>
        <transformer name="RunCaribouRSF"/>
      </include>
    </transformer>
    
    <transformer
      name="LoadSpadesOutputs"
      isRunnable="True"
      runContext="LocalOnly"
      programName="Rscript"
      programArguments="load_spades_outputs.R">
      <datafeeds>
        
        <!-- Scenario Datafeeds -->
        <datafeed name="InputSpadesObject" displayName="SpaDES" dataScope="Scenario">
          <datasheets>
            <datasheet name="InputSpadesObject" displayName="SpaDES" isSingleRow="True">
              <columns>
                <column name="ScenarioID" dataType="Integer" isPrimary="True"/>
                <column name="Filename" displayName="SpaDES Object Path" dataType="String" allowDbNull="False" isExternalFile="True"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
      
      </datafeeds>
    </transformer>
    
    <transformer
      name="PrepareHabitatModel"
      isRunnable="True"
      runContext="LocalOnly"
      programName="Rscript"
      programArguments="prepare_habitat_model.R">
      <!-- NO Datafeeds in this transformer-->
    </transformer>
    
    <transformer
      name="RunCaribouRSF"
      isRunnable="True"
      runContext="AllowRemote"
      programName="Rscript"
      className="SyncroSim.StochasticTime.StochasticTimeTransformer"
      classAssembly="SyncroSim.StochasticTime"
      configurationSheet="ROFSim_RunControl"
      programArguments="run_caribou_model.R">
      <datafeeds>
        
        <!-- Project Datafeeds -->
        <datafeed name="SpatialVariable" displayName="Spatial Variable" dataScope="Project">
          <datasheets>
            <datasheet name="SpatialVariable" displayName="Spatial Variable" valueMember="VariableID" displayMember="VariableName">
              <columns>
                <column name="SpatialVariableID" dataType="Integer" isPrimary="True"/>
                <column name="ProjectID" dataType="Integer"/>
                <column name="VariableName" dataType="String"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="TabularVariable" displayName="Tabular Variable" dataScope="Project">
          <datasheets>
            <datasheet name="TabularVariable" displayName="Tabular Variable" valueMember="VariableID" displayMember="VariableName">
              <columns>
                <column name="TabularVariableID" dataType="Integer" isPrimary="True"/>
                <column name="ProjectID" dataType="Integer"/>
                <column name="VariableName" dataType="String"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="ForestUnit" displayName="Forest Unit" dataScope="Project">
          <datasheets>
            <datasheet name="ForestUnit" displayName="Forest Unit">
              <columns>
                <column name="ForestUnitID" dataType="Integer" isPrimary="True"/>
                <column name="ProjectID" dataType="Integer"/>
                <column name="Name" dataType="String"/>
                <column name="ID" dataType="Integer"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="LandCoverClass" displayName="Land Cover Class" dataScope="Project">
          <datasheets>
            <datasheet name="LandCoverClass" displayName="Land Cover Class">
              <columns>
                <column name="LandCoverClassID" dataType="Integer" isPrimary="True"/>
                <column name="ProjectID" dataType="Integer"/>
                <column name="Name" dataType="String"/>
                <column name="ID" dataType="Integer"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="CaribouRange" displayName="Caribou Range" dataScope="Project">
          <datasheets>
            <datasheet name="CaribouRange" displayName="Caribou Range" valueMember="CaribouRangeID" displayMember="Name">
              <columns>
                <column name="CaribouRangeID" dataType="Integer" isPrimary="True"/>
                <column name="ProjectID" dataType="Integer"/>
                <column name="Name" dataType="String" allowDbNull="False"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="Season" displayName="Season" dataScope="Project">
          <datasheets>
            <datasheet name="Season" displayName="Season" valueMember="SeasonID" displayMember="Name">
              <columns>
                <column name="SeasonID" dataType="Integer" isPrimary="True"/>
                <column name="ProjectID" dataType="Integer"/>
                <column name="Name" dataType="String" allowDbNull="False"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        
        <datafeed name="FileSource" displayName="File Source" dataScope="Project">
          <datasheets>
            <datasheet name="FileSource" displayName="File Source" valueMember="FileSourceID" displayMember="Name">
              <columns>
                <column name="FileSourceID" dataType="Integer" isPrimary="True"/>
                <column name="ProjectID" dataType="Integer"/>
                <column name="Name" dataType="String" allowDbNull="False"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        
        <!-- Scenario Datafeeds -->
        <!-- Spatial Variables -->
        <!-- Raster -->
        <datafeed name="RasterVariableFiles" displayName="Raster Variable Files" dataScope="Scenario">
          <datasheets>
            <datasheet name="RasterVariableFiles" displayName="Raster Variable Files">
              <columns>
                <column name="RasterVariableFilesID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer"/>
                <column name="Iteration" dataType="Integer" validationType="WholeNumber" validationCondition="Greater" formula1="0" format="d" isOptional="True"/>
                <column name="Timestep" dataType="Integer" validationType="WholeNumber" validationCondition="GreaterEqual" formula1="0" isOptional="True"/>
                <column name="SpatialVariable" dataType="Integer" validationType="Datasheet" formula1="SpatialVariable"/>
                <column name="File" dataType="String" isExternalFile="True" allowDbNull="True" isRaster="True"/>
                <column name="FileSource" dataType="Integer" validationType="Datasheet" formula1="FileSource"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        <!-- Other, non-raster variables -->
        <datafeed name="OtherSpatialVariableFiles" displayName="Other Spatial Variable Files" dataScope="Scenario">
          <datasheets>
            <datasheet name="OtherSpatialVariableFiles" displayName="Other Spatial Variable Files">
              <columns>
                <column name="OtherSpatialVariableFilesID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer"/>
                <column name="Iteration" dataType="Integer" validationType="WholeNumber" validationCondition="Greater" formula1="0" format="d" isOptional="True"/>
                <column name="Timestep" dataType="Integer" validationType="WholeNumber" validationCondition="GreaterEqual" formula1="0" isOptional="True"/>
                <column name="SpatialVariable" dataType="Integer" validationType="Datasheet" formula1="SpatialVariable"/>
                <column name="File" dataType="String"/>
                <column name="FileSource" dataType="Integer" validationType="Datasheet" formula1="FileSource"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        
        <datafeed name="TabularVariableValues" displayName="Tabular Variable Values" dataScope="Scenario">
          <datasheets>
            <datasheet name="TabularVariableValues" displayName="Tabular Variable Values">
              <columns>
                <column name="TabularVariableValuesID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer" />
                <column name="Iteration" dataType="Integer" validationType="WholeNumber" validationCondition="Greater" formula1="0" format="d" isOptional="True"/>
                <column name="Timestep" dataType="Integer" validationType="WholeNumber" validationCondition="GreaterEqual" formula1="0" isOptional="True"/>
                <column name="TabularVariable" dataType="Integer" validationType="Datasheet" formula1="TabularVariable"/>
                <column name="Value" dataType="Integer"/>
                <column name="FileSource" dataType="Integer" validationType="Datasheet" formula1="FileSource"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="RunControl" displayName="Run Control" dataScope="Scenario">
          <datasheets>
            <datasheet name="RunControl" displayName="Run Control" isSingleRow="True">
              <columns>
                <column name="RunControlID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer"/>
                <column name="MinimumIteration" isVisible="False" displayName="Minimum Iteration" dataType="Integer" defaultValue="1" validationType="WholeNumber" validationCondition="GreaterEqual" formula1="1" format="d"/>
                <column name="MaximumIteration" displayName="Total Iterations" dataType="Integer" defaultValue="1" validationType="WholeNumber" validationCondition="GreaterEqual" formula1="1" format="d"/>
                <column name="MinimumTimestep" displayName="Minimum Timestep" dataType="Integer" defaultValue="0" validationType="WholeNumber" validationCondition="GreaterEqual" formula1="0" format="d"/>
                <column name="MaximumTimestep" displayName="Maximum Timestep" dataType="Integer" defaultValue="0" validationType="WholeNumber" validationCondition="GreaterEqual" formula1="0" format="d"/>
              </columns>
              <validations>
                <validation validationType="LessEqual" columns="MinimumIteration|MaximumIteration"/>
                <validation validationType="LessEqual" columns="MinimumTimestep|MaximumTimestep"/>
              </validations>
            </datasheet>
          </datasheets>  
        </datafeed>
        <datafeed name="RunCaribouRange" displayName="Run Caribou Range" dataScope="Scenario" isSingleRow="True">
          <datasheets>
            <datasheet name="RunCaribouRange" displayName="Caribou Range">
              <columns>
                <column name="RunCaribouRangeID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer"/>
                <column name="RangeID" dataType="Integer" validationType="Datasheet" formula1="CaribouRange"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="ModelOptions" displayName="Model Options" dataScope="Scenario">
          <datasheets>
            <datasheet name="ModelOptions" displayName="Model Options" isSingleRow="True">
              <columns>
                <column name="ScenarioID" dataType="Integer" isPrimary="True"/>
                <column name="PadProjPoly" displayName="Project Polygon Padding" dataType="Boolean"/>
                <column name="PadFocal" displayName="Focal Padding" dataType="Boolean"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        
        <!-- Outputs Datafeeds --> 
        <datafeed name="OutputSpatialHabitat" displayName="Output Habitat Spatial" dataScope="Scenario" isOutput="True">
          <datasheets>
            <datasheet name="OutputSpatialHabitat" displayName="Output Habitat Spatial">
              <columns>
                <column name="OutputSpatialHabitatID" dataType="Integer" isPrimary="True"/>
                <column name="Iteration" dataType="Integer" validationType="WholeNumber" validationCondition="Greater" formula1="0" format="d" isOptional="True"/>
                <column name="Timestep" dataType="Integer" validationType="WholeNumber" validationCondition="GreaterEqual" formula1="0" isOptional="True"/>
                <column name="ScenarioID" dataType="Integer"/>
                <column name="RangeID" dataType="Integer" validationType="Datasheet" formula1="CaribouRange" allowDbNull="False"/>
                <column name="SeasonID" dataType="Integer" validationType="Datasheet" formula1="Season" allowDbNull="False"/>
                <column name="FileName" dataType="String" isExternalFile="True" isRaster="True" bandColumn="Band" bandFilterColumn="Season" allowDbNull="False" filenameCode="habuse"/>
                <column name="Band" dataType="Integer" isOptional="True"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        <datafeed name="OutputHabitat" displayName="Output Habitat " dataScope="Scenario" isOutput="True">
          <datasheets>
            <datasheet name="OutputHabitat" displayName="Output Habitat">
              <columns>
                <column name="OutputHabitatID" dataType="Integer" isPrimary="True"/>
                <column name="Iteration" dataType="Integer" validationType="WholeNumber" validationCondition="Greater" formula1="0" format="d" isOptional="True"/>
                <column name="Timestep" dataType="Integer" validationType="WholeNumber" validationCondition="GreaterEqual" formula1="0" isOptional="True"/>
                <column name="ScenarioID" dataType="Integer"/>
                <column name="RangeID" dataType="Integer" validationType="Datasheet" formula1="CaribouRange" allowDbNull="False"/>
                <column name="SeasonID" dataType="Integer" validationType="Datasheet" formula1="Season" allowDbNull="False"/>
                <column name="Amount" dataType="Integer" />
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
        
      </datafeeds>
      
    </transformer>
    
  </transformers>
  
  <!-- Layouts -->
  <layouts>
    <layout name="coreforms_LibraryDatafeeds">
      <item name="core_Rconfig"/>
    </layout>
    
     <!-- Project feeds layouts -->
    <layout name="coreforms_ProjectDatafeeds">
      <item name="SpatialVariable"/>
      <item name="TabularVariable"/>
      <item name="ForestUnit"/>
      <item name="LandCoverClass"/>
      <item name="CaribouRange"/>
      <item name="Season"/>
      <group name="Pipeline">
        <item name="core_Transformer"/>
        <item name="core_StageName"/>
        <item name="core_StageValue"/>        
      </group>
      <item name="FileSource"/>
    </layout>
    
    <!-- Scenario feeds layouts -->
    <layout name="coreforms_ScenarioDatafeeds">
      
      <group name="RunControlAll" displayName="Run Control">
        <item name="RunControl"/>
        <item name="RunCaribouRange"/>
      </group>
      <item name="ModelOptions"/>
      <group name="Inputs" displayName="Inputs">
        <item name="InputSpadesObject"/>
        <item name="RasterVariableFiles"/>
        <item name="OtherSpatialVariableFiles"/>
        <item name="TabularVariableValues"/>
      </group>
      <group name="Outputs" displayName="Outputs">
        <item name="OutputHabitat"/>
        <item name="OutputSpatialHabitat"/>
      </group>
      
      <item name="core_Pipeline"/>
      
    </layout>
    
    <!--Results transformer Layout-->
    <layout name="coreforms_ResultTransformers">
      <item name="corestime_MapTransformer"/>
    </layout>
    
    <!--Maps Layout-->
    <layout name="corestimeforms_Maps" configurationSheet="ROFSim_RunControl">
      <group name="OutputHabitat" displayName="Habitat">
        <item name="OutputSpatialHabitat" displayName="Season" dataSheet="ROFSim_OutputSpatialHabitat" column="FileName" filter="SeasonID"/>
      </group>
    </layout>
  
  </layouts>

</package>